# 제품 요구사항 문서(PRD) — 4컷 일기 카툰 생성 앱

- 문서 버전: 0.1 (초안)
- 작성일: 2025-10-13
- 문서 상태: Draft

## 1. 제품 개요
- 이미지 생성 모델을 사용하여 사용자의 일기를 기반으로 4컷 카툰 이미지를 자동 생성하는 웹 앱.
- 사용자는 매일 일기를 작성하고, 생성된 카툰을 캘린더에서 날짜별로 열람/관리.

## 2. 목표와 비범위
- 목표
  - 일기 쓰기 습관 형성에 도움을 주는 즉각적이고 즐거운 보상(4컷 카툰) 제공
  - 1분 내 생성 완료, 간단한 사용 흐름, 낮은 진입 장벽
  - 개인 기록을 바탕으로 한 프라이빗한 경험 우선
- 비범위(초기)
  - 공개 피드/소셜 기능, 댓글/좋아요
  - 고급 이미지 편집 툴(말풍선/스티커 편집 등)
  - 모바일 앱(네이티브) — 웹 앱으로 시작

## 3. 성공 지표(KPIs)
- D1/D7 일기 작성율(작성 사용자 비율)
- 4컷 생성 완료율(생성 성공/요청 비율) ≥ 95%
- 평균 생성 소요시간 T90 ≤ 90초 (프롬프트+이미지 전체)
- 일간 재방문율(DAU/WAU), 7일 캘린더 완주율
- 재생성(리롤) 비율과 만족도(별점/이모지) 수집(선택)

## 4. 대상 사용자/페르소나
- 가벼운 일기 습관을 만들고 싶은 사용자
- 텍스트 기록을 시각적으로 간직/공유하고 싶은 사용자(사적 공유 중심)

## 5. 사용자 스토리(요구사항 형태)
- “나는 계정을 만들고 간단한 프로필을 설정하고 싶다.”
- “나는 오늘의 일기를 작성하고, 1분 내 4컷 카툰을 받고 싶다.”
- “마음에 들지 않으면 동일 일기에 대해 재생성(프롬프트/시드 변경)하고 싶다.”
- “달력에서 날짜별로 내가 작성한 일기와 카툰을 다시 보고 싶다.”
- “완성된 4컷을 저장(다운로드)하거나 개인적으로 공유하고 싶다(선택).”

## 6. 핵심 기능(MVP)과 수용 기준(AC)
1) 인증/프로필
   - 이메일/비밀번호 기반 로그인/회원가입
   - 프로필(닉네임, 아바타, 타임존) 편집 가능
   - AC: 신규 사용자 1분 이내 온보딩 완료, 세션 유지 7일

2) 일기 작성
   - 날짜별 1개 이상의 일기 작성(텍스트 최소 20자 권장)
   - 기분(선택), 태그(선택) 메타데이터 입력 가능
   - AC: 저장 즉시 버전 관리 및 자동 임시저장(30초 간격, 선택)

3) 프롬프트 생성(OpenAI GPT 활용)
   - 일기 텍스트를 분석해 4컷 각각의 장면 설명, 등장인물, 스타일, 감정 톤을 포함하는 프롬프트 생성
   - 일관된 캐릭터/스타일을 유지하도록 시스템 지침 포함
   - AC: 프롬프트 생성 3초 내, 구조적 JSON/마크다운 출력

4) 이미지 생성(HuggingFace Qwen/Qwen-Image)
   - 4개의 이미지(컷) 생성, 동일 스타일·캐릭터 일관성 유지 시도
   - 해상도 기본 512x512, 최대 768x768(선택)
   - AC: 요청당 4컷 전부 성공 생성 ≥ 95%, 실패 시 자동 재시도 ≤ 1회

5) 4컷 카툰 합성/표시
   - 2x2 그리드 합성, 캡션/컷 번호(선택) 표시
   - 개별 컷 원본도 별도 저장
   - AC: 합성 이미지와 개별 컷 모두 보기/다운로드 가능

6) 캘린더/히스토리
   - 월 단위 캘린더 UI에서 날짜별 일기/카툰 썸네일 표시
   - 검색/필터: 감정, 태그(선택)
   - AC: 월 전환 200ms 내, 썸네일 로딩 지연 최소화(프리패치)

7) 재생성/관리(선택)
   - 동일 일기에 대해 프롬프트나 시드 변경 후 재생성
   - AC: 이전 버전 보관, 가장 만족한 버전을 기본 표시

## 7. 기술 스택(초안 근거: prd_draft.md)
- 웹 서버: Django
- 데이터베이스: SQLite(초기), 향후 PostgreSQL 이관 고려
- 프롬프트 생성: OpenAI GPT
- 이미지 생성: Hugging Face Hub — `Qwen/Qwen-Image`

## 8. 시스템 아키텍처(개요)
- Web UI(SSR/템플릿) ↔ Django API ↔ DB
- 비동기 작업 권장: 프롬프트 생성 → 이미지 생성 → 합성(작업 큐)
  - 초기 단순화: 동기 처리로 시작 가능하나, 생성 대기 시간 표시 필요(프로그레스/스피너)
- 외부 연동
  - OpenAI API: 텍스트→구조화 프롬프트
  - HF Inference Endpoint 또는 로컬/서버 호스팅: 이미지 생성

## 9. 주요 흐름(파이프라인)
1) 사용자가 일기 저장 → 작업 생성(Queued)
2) GPT로 4컷 프롬프트 구조화 생성(JSON)
3) 컷별로 Qwen-Image 호출(동시/순차), 결과 저장
4) 2x2 합성 이미지 생성 및 저장
5) 상태 Succeeded로 업데이트, UI에 썸네일/원본 노출

## 10. 데이터 모델(초안)
- User(id, email, password_hash, created_at, last_login)
- Profile(id, user_id FK, nickname, avatar_url, timezone)
- DiaryEntry(id, user_id FK, date, title?, content, mood?, tags?, created_at)
- Prompt(id, diary_entry_id FK, body_text, model, params_json, created_at)
- Cartoon(id, diary_entry_id FK, status[queued|running|succeeded|failed], seed?, guidance?, grid_url?, fail_reason?, created_at, completed_at)
- CartoonPanel(id, cartoon_id FK, index(1-4), image_url, caption?)

인덱스/제약
- DiaryEntry: (user_id, date) 유니크
- Cartoon: diary_entry_id 유니크(기본), 재생성 시 버전 필드(version)로 다중 허용

## 11. API(예시, 서버 내부용 포함)
- POST `/api/auth/signup`, `/api/auth/login`
- GET/PUT `/api/profile/me`
- POST `/api/diaries` (일기 작성), GET `/api/diaries?month=YYYY-MM`
- GET `/api/diaries/{id}` (상세), POST `/api/diaries/{id}/generate` (생성 트리거)
- GET `/api/cartoons/{diary_id}` (상태/결과 조회)
- POST `/api/cartoons/{diary_id}/reroll` (재생성)

## 12. UX 화면(핵심)
- 온보딩/로그인, 프로필 편집
- 일기 작성 화면(텍스트, 감정, 태그)
- 생성 대기/진행 표시(큐 상태, 남은 예상 시간)
- 결과 화면(4컷 그리드, 개별 컷 보기/다운로드, 재생성)
- 캘린더 화면(날짜별 썸네일, 필터)

## 13. 비기능 요구사항(NFR)
- 성능: 생성 요청당 T90 ≤ 90초, 웹 응답 TTI ≤ 2초
- 안정성: 실패 시 재시도 1회, 부분 실패 시 사용자 안내
- 보안/개인정보: 비공개 기본, PII 최소 수집, 일기 데이터 접근 통제/권한 검증
- 비용: 외부 API 호출 수 제한, 썸네일/캐시로 재호출 최소화
- 로깅/관측: 생성 시간, 실패율, 사용자 행동 이벤트(익명화)

## 14. 리스크 및 대응
- 모델 품질/일관성: 시스템 프롬프트 강화, 예시-샷 제공, 컷 간 참조 토큰 설계
- 비용/속도: 배치/동시성 제어, 캐시, 큐/워커 확장성
- 안전/콘텐츠: 금지 토픽 필터, 키워드 스크러빙, 재생성 가이드 제공
- 외부 의존성: API 장애 대비 대체 모델/오프라인 큐 축적

## 15. 마일스톤(5일)
- D1: Django 뼈대, 인증/프로필, DB 스키마, 캘린더 기본
- D2: 일기 작성/조회, 생성 파이프라인 스켈레톤(GPT 프롬프트)
- D3: 이미지 생성 연동(Qwen-Image), 2x2 합성, 결과 화면
- D4: NFR 보강(로깅/에러), 재생성/다운로드, 베타 릴리스

## 16. 오픈 이슈
- 프롬프트 포맷 표준(JSON vs Markdown) 및 캐릭터 일관성 전략
- HF 호출 방식(호스팅/엔드포인트)과 비용/성능 프로파일링
- 콘텐츠 안전 가이드라인/필터 수준, 연령 제한 정책
- 장기 저장소(S3 등) 및 CDN 도입 시점

