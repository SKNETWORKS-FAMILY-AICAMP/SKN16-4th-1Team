{% extends 'entry/base_subpage.html' %}
{% block title %}환경설정{% endblock %}
{% block content %}
<section class="profile-section">
    <h1 class="section-title">⚙️ 환경설정</h1>
    <div class="info-group">
        <h2>테마 선택</h2>
        <select id="theme-select" class="form-select">
            <option value="classic">기본</option>
            <option value="light">라이트</option>
            <option value="dark">다크</option>
        </select>
    </div>
    <div class="info-group">
        <h2>언어 선택</h2>
        <select id="language-select" class="form-select"><option value="ko">한국어</option><option value="en">English</option></select>
    </div>
    <div class="info-group">
        <div class="info-header" style="border:none;">
            <h2>알림 받기</h2>
            <label class="switch"><input type="checkbox" id="notification-toggle" checked><span class="slider round"></span></label>
        </div>
    </div>
    <div style="display: flex; justify-content: flex-end; margin-top: 2rem;">
        <button id="save-settings-btn" class="btn-submit" style="width: auto; padding: 0.75rem 1.5rem;">변경사항 저장</button>
    </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const themeSelect = document.getElementById('theme-select');
    const languageSelect = document.getElementById('language-select');
    const notificationToggle = document.getElementById('notification-toggle');
    const saveSettingsBtn = document.getElementById('save-settings-btn');

    // 👇👇👇 '저장' 버튼 클릭 시, 테마를 즉시 html에 적용하는 로직 추가 👇👇👇
    saveSettingsBtn.addEventListener('click', function() {
        const theme = themeSelect.value;
        localStorage.setItem('theme', theme);
        localStorage.setItem('language', languageSelect.value);
        localStorage.setItem('notifications', notificationToggle.checked);

        // 1. html 태그에서 'dark'와 'classic' 클래스를 모두 제거
        document.documentElement.classList.remove('dark', 'classic');
        
        // 2. 선택한 테마에 맞는 클래스만 추가
        if (theme === 'dark') {
            document.documentElement.classList.add('dark');
        } else if (theme === 'classic') {
            document.documentElement.classList.add('classic');
        }
        // 'light' 테마는 아무 클래스도 추가하지 않으면 됩니다.

        alert('설정이 저장되었습니다.');
    });

    // 페이지 로드 시 저장된 설정 불러오기 (기존과 동일)
    (function loadSettings() {
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) themeSelect.value = savedTheme;
        const savedLang = localStorage.getItem('language');
        if (savedLang) languageSelect.value = savedLang;
        const savedNotif = localStorage.getItem('notifications');
        if (savedNotif !== null) notificationToggle.checked = savedNotif === 'true';
    })();
});
</script>
{% endblock %}